- @page_title = "#{@register.name.capitalize} Register"
- @page_description = ""

.grid-row
  .column-two-thirds
    %h1.heading-xlarge= @page_title

    = govspeak(@register.history)

    %h2 Project history
    .phase-history
      - @register.phases.each do |phase|
        %div{class: "phase-history-item border-#{phase.name.downcase} txt-#{phase.name.downcase}"}
          %h3= link_to phase.name, "#{'#' + phase.name.downcase}", class: "tag tag-history #{phase.name.downcase}"
          %p= phase.phase_update

    %h2 Project updates

    - @register.phases.each do |phase|
      - grouped_steps = @register.steps.select { |step| step.step_phase == phase.name }

      %div{class: "#{phase.name.downcase}-headline", id: "#{phase.name.downcase}"}
        %strong= phase.name

      - grouped_steps.each do |step|
        %h3{class: "heading-medium", id: "#{step.title.parameterize}"}= step.title
        = govspeak(step.content)

  .column-third
    %aside#related
      .related-container
        .group
          .phase-circle
            %p{class: "circle #{@register.register_phase.downcase} register_phase"}
            %p.circle-label= @register.register_phase.capitalize
          - if @register.url.present?
            %h4.heading-small Register url
            %p= link_to @register.url, @register.url, rel: 'external'
          %h4.heading-small Registry
          %p= @register.authority
          - if @register.custodian.present?
            %h4.heading-small Custodian
            %p= @register.custodian

          %hr

          - @register.phases.each do |phase|
            - grouped_steps = @register.steps.select { |step| step.step_phase == phase.name }

            %h4.heading-small= phase.name

            %ul.no-bullets
              - grouped_steps.each do |step|
                %li
                  - if step.completed.present?
                    %svg#Layer_1{"enable-background" => "new 0 0 35 35", :height => "30px", :space => "preserve", :version => "1.1", :viewbox => "0 0 35 35", :width => "30px", :x => "0px", :xmlns => "http://www.w3.org/2000/svg", "xmlns:xlink" => "http://www.w3.org/1999/xlink", :y => "0px"}
                      %g
                        %g
                          %path{:d => "M12.393,29.908", :fill => "#231F20"}
                      %g
                        %polyline{:fill => "#FFFFFF", :points => "30.848,7.857 12.811,25.895 3.836,16.921 \t"}
                        %polygon{:fill => "#231F20", :points => "27.012,11.66 10.742,27.93 3.535,20.724 0,24.26 10.742,35 30.547,15.195 \t"}
                  - else
                    %svg#Layer_1{"enable-background" => "new 0 0 35 35", :height => "30px", :space => "preserve", :version => "1.1", :viewbox => "0 0 35 35", :width => "30px", :x => "0px", :xmlns => "http://www.w3.org/2000/svg", "xmlns:xlink" => "http://www.w3.org/1999/xlink", :y => "0px"}
                  = link_to step.title, "#{ '#' + step.title.parameterize}"

.grid-row
  .column-two-thirds
    %p= link_to "All registers", '/registers', class: 'link-back'
